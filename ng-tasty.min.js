angular.module("ngTasty",["ngTasty.filter","ngTasty.service","ngTasty.table"]),angular.module("ngTasty.filter",["ngTasty.filter.cleanFieldName","ngTasty.filter.range"]),angular.module("ngTasty.filter.cleanFieldName",[]).filter("cleanFieldName",function(){return function(e){return e.replace(/[^a-zA-Z0-9-]+/g,"-").toLowerCase()}}),angular.module("ngTasty.filter.range",[]).filter("range",function(){return function(e,a,n){var t;if(t=[],"undefined"==typeof a&&(a=e,e=0),"undefined"==typeof n&&(n=1),n>0&&e>=a||0>n&&a>=e)return[];for(var r=e;n>0?a>r:r>a;r+=n)t.push(r);return t}}),angular.module("ngTasty.service",["ngTasty.service.debounce","ngTasty.service.setProperty","ngTasty.service.joinObjects"]),angular.module("ngTasty.service.debounce",[]).factory("debounce",["$timeout",function(e){return function(a,n){var t;return function(){var r=this,i=arguments;e.cancel(t),t=e(function(){t=null,a.apply(r,i)},n)}}}]),angular.module("ngTasty.service.setProperty",[]).factory("setProperty",function(){return function(e,a,n){return angular.isDefined(a[n])&&(e[n]=a[n]),e}}),angular.module("ngTasty.service.joinObjects",[]).factory("joinObjects",["setProperty",function(e){return function(a,n){for(var t in n)e(a,n,t);return a}}]),angular.module("ngTasty.table",["ngTasty.filter.cleanFieldName","ngTasty.filter.range","ngTasty.service.debounce","ngTasty.service.setProperty","ngTasty.service.joinObjects"]).constant("tableConfig",{query:{page:"page",count:"count",sortBy:"sort-by",sortOrder:"sort-order"},resource:void 0}).controller("TableController",["$scope","$attrs","tableConfig","debounce","setProperty","joinObjects",function(e,a,n,t,r,i){"use strict";if(this.$scope=e,e.query=n.query,e.resource=n.resource,angular.isDefined(a.query)&&(e.query=e.$parent.$eval(a.query)),!angular.isDefined(a.resource))throw"AngularJS tastyTable directive: miss the resource attribute";if(e.resource=e.$parent.$eval(a.resource),!e.resource)throw"AngularJS tastyTable directive: the resource ("+a.resource+") callback it's undefined";e.url="",e.header={columns:[]},e.rows=[],e.params={},e.pagination={},e.theadDirective=!1,e.paginationDirective=!1,this.activate=function(a){e[a+"Directive"]=!0,e.params[a]=!0},this.setParams=function(a,n){e.params[a]=n},e.setDirectivesValues=function(a){return a?(e.rows=a.rows,e.header={columns:a.header,sortBy:a.sortBy,sortOrder:a.sortOrder},void(e.pagination=a.pagination)):!1},e.buildUrl=function(n,t){var o,s;return o={},e.theadDirective&&(o=r(o,n,"sortBy"),o=r(o,n,"sortOrder")),e.paginationDirective&&(o=r(o,n,"page"),o=r(o,n,"count")),a.filters&&(o=i(o,t)),Object.keys(o).map(function(a){return s=o[a],e.query[a]&&(a=e.query[a]),encodeURIComponent(a)+"="+encodeURIComponent(s)}).join("&")},e.updateResource=t(function(){e.url=e.buildUrl(e.params,e[a.filters]),e[a.resource](e.url).then(function(a){e.setDirectivesValues(a)})},100),e.initDirective=function(){e.params.sortBy=void 0,e.params.sortOrder="asc",e.params.page=1,e.params.count=5,e.updateResource()},a.filters&&e.$watch(a.filters,function(a,n){a!==n&&e.updateResource()},!0),e.$watch("params",function(a,n){a!==n&&e.updateResource()},!0),e.initDirective()}]).directive("tastyTable",function(){return{restrict:"A",scope:!0,controller:"TableController"}}).directive("tastyThead",["$filter",function(e){return{restrict:"AE",require:"^tastyTable",scope:{notSortBy:"="},templateUrl:"template/table/head.html",link:function(a,n,t,r){"use strict";var i;r.activate("thead"),a.fields={},i=function(){var n,t;for(n=a.header.columns.length,t=0;n>t;t++)a.fields[a.header.columns[t].key]={width:parseFloat((100/n).toFixed(2)),sort:e("cleanFieldName")(a.header.columns[t].key)};"dsc"===a.header.sortOrder&&(a.header.sortBy="-"+a.header.sortBy)},a.sortBy=function(n){if(a.notSortBy&&a.notSortBy.indexOf(n.key)>=0)return!1;var t;t=e("cleanFieldName")(n.key),a.header.sortBy==t?(a.header.sortBy="-"+t,r.setParams("sortOrder","dsc")):(a.header.sortBy=t,r.setParams("sortOrder","asc")),r.setParams("sortBy",n.key)},a.isSortUp=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy=="-"+a.fields[e.key].sort},a.isSortDown=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy==a.fields[e.key].sort},r.$scope.$watch("header",function(e,n){e&&e!==n&&(a.header=e,i())})}}}]).directive("tastyPagination",["$filter",function(e){return{restrict:"AE",require:"^tastyTable",scope:{},templateUrl:"template/table/pagination.html",link:function(a,n,t,r){"use strict";var i,o,s,g,u,c;r.activate("pagination"),a.numPaginations=5,a.pagListCount=[5,25,50,100],a.pagination={},a.pagMinRange=1,a.pagMaxRange=1,i=function(e){r.setParams("page",e)},o=function(e){var n,t;n=e*a.pagination.page,n>a.pagination.size&&(t=Math.ceil(a.pagination.size/e),r.setParams("page",t)),r.setParams("count",e)},s=function(){var e;e=a.pagination.page,e>a.pagination.pages&&(e=a.pagination.pages),a.pagMinRange=e-2>0?e-2:1,a.pagMaxRange=e+2,a.pagination.page=e,c()},g=function(){return a.pagHideMinRange===!0||a.pagMinRange<1?!1:(a.pagMaxRange=a.pagMinRange,a.pagMinRange=a.pagMaxRange-a.numPaginations,void c())},u=function(){return a.pagHideMaxRange===!0||a.pagMaxRange>a.pagination.pages?!1:(a.pagMinRange=a.pagMaxRange,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages),a.pagMinRange=a.pagMaxRange-a.numPaginations,void c())},c=function(){a.pagMinRange=a.pagMinRange>0?a.pagMinRange:1,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages+1),a.pagHideMinRange=a.pagMinRange<=1,a.pagHideMaxRange=a.pagMaxRange>=a.pagination.pages,a.pagListCount=a.pagination.size<50?[5,25]:a.pagination.size<100?[5,25,50]:[5,25,50,100],a.rangePage=e("range")(a.pagMinRange,a.pagMaxRange)},a.page={get:i,setCount:o,previous:g,remaining:u},r.$scope.$watch("pagination",function(e,n){e&&e!==n&&(a.pagination=e,s())})}}}]);