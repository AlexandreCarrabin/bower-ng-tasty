angular.module("ngTasty",["ngTasty.table"]),angular.module("ngTasty.table",[]).directive("tastyTable",["$timeout",function(a){return{restrict:"A",scope:!0,controller:function(a){this.$scope=a},link:function(e,n,t){"use strict";var r,i,o,s,g;if(!t.resource)throw"AngularJS tastyTable directive: miss the resource attribute";if(!e[t.resource])throw"AngularJS tastyTable directive: the resource ("+t.resource+") callback it's undefined";e.query={page:"page",count:"count",sortBy:"sort-by",sortOrder:"sort-order"},e.header={columns:[]},e.rows=[],e.params={},e.thead=!1,e.pagination=!1,e.resourcePagination={},e.url="",r=function(a){return a?(e.rows=a.rows,e.header={columns:a.header,sortBy:a.sortBy,sortOrder:a.sortOrder},void(e.resourcePagination=a.pagination)):!1},i=function(a,e,n){return e[n]&&(a[n]=e[n]),a},o=function(a,e){for(var n in e)i(a,e,n);return a},s=function(a,n){var r,s;return r={},e.thead&&(r=i(r,a,"sortBy"),r=i(r,a,"sortOrder")),e.pagination&&(r=i(r,a,"page"),r=i(r,a,"count")),t.filters&&(r=o(r,n)),Object.keys(r).map(function(a){return s=r[a],e.query[a]&&(a=e.query[a]),encodeURIComponent(a)+"="+encodeURIComponent(s)}).join("&")},g=function(a,n){a!==n&&(e.url=s(e.params,e[t.filters]),e[t.resource](e.url).then(function(a){r(a)}))},a(function(){e.params.sortBy=void 0,e.params.sortOrder="asc",e.params.page=1,e.params.count=5},100),t.filters&&e.$watch(t.filters,g,!0),e.$watch("params",g,!0)}}}]).directive("tastyThead",function(){return{restrict:"AE",require:"^tastyTable",scope:{},templateUrl:"template/table/tasty-head.html",link:function(a,e,n,t){"use strict";var r,i,o;t.$scope.thead=!0,a.fields={},o=!0,r=function(a){return a.replace(/[^a-zA-Z0-9-]+/g,"-").toLowerCase()},i=function(){var e,n;for(e=a.header.columns.length,n=0;e>n;n++)a.fields[a.header.columns[n].key]={width:100/e,sort:r(a.header.columns[n].key)};"dsc"===a.header.sortOrder&&(a.header.sortBy="-"+a.header.sortBy)},a.sortBy=function(e){var n;n=r(e.key),a.header.sortBy==n?(a.header.sortBy="-"+n,t.$scope.params.sortOrder="dsc"):(a.header.sortBy=n,t.$scope.params.sortOrder="asc"),t.$scope.params.sortBy=e.key},a.isSortUp=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy=="-"+a.fields[e.key].sort},a.isSortDown=function(e){return void 0===a.fields[e.key]?!1:a.header.sortBy==a.fields[e.key].sort},t.$scope.$watch("header",function(e,n){e&&e!==n&&(a.header=t.$scope.header,i())})}}}).directive("tastyPagination",function(){return{restrict:"AE",require:"^tastyTable",scope:{},templateUrl:"template/table/tasty-pagination.html",link:function(a,e,n,t){"use strict";var r,i,o,s,g,p,u,c;t.$scope.pagination=!0,a.numPaginations=5,a.pagListCount=[5,25,50,100],a.pagination={},a.pagMinRange=1,a.pagMaxRange=1,u=!0,c=function(a,e){var n;n=[],a=parseInt(a,10),e=parseInt(e,10);for(var t=a;e>t;t++)n.push(t);return n},r=function(a){t.$scope.params.page=a},i=function(e){var n;n=e*a.pagination.page,n>a.pagination.size&&(t.$scope.params.page=Math.ceil(a.pagination.size/e)),t.$scope.params.count=e},o=function(){var e;e=a.pagination.page,e>a.pagination.pages&&(e=a.pagination.pages),a.pagMinRange=e-2>0?e-2:1,a.pagMaxRange=e+2,a.pagination.page=e,p()},s=function(){return a.pagHideMinRange===!0||a.pagMinRange<1?!1:(a.pagMaxRange=a.pagMinRange,a.pagMinRange=a.pagMaxRange-a.numPaginations,void p())},g=function(){return a.pagHideMaxRange===!0||a.pagMaxRange>a.pagination.pages?!1:(a.pagMinRange=a.pagMaxRange,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages),a.pagMinRange=a.pagMaxRange-a.numPaginations,void p())},p=function(){a.pagMinRange=a.pagMinRange>0?a.pagMinRange:1,a.pagMaxRange=a.pagMinRange+a.numPaginations,a.pagMaxRange>a.pagination.pages&&(a.pagMaxRange=a.pagination.pages+1),a.pagHideMinRange=a.pagMinRange<=1,a.pagHideMaxRange=a.pagMaxRange>=a.pagination.pages,a.pagListCount=a.pagination.size<50?[5,25]:a.pagination.size<100?[5,25,50]:[5,25,50,100],a.rangePage=c(a.pagMinRange,a.pagMaxRange)},a.page={get:r,setCount:i,previous:s,remaining:g},t.$scope.$watch("resourcePagination",function(e,n){e&&e!==n&&(a.pagination={count:e.count,page:e.page,pages:e.pages,size:e.size},o())})}}});